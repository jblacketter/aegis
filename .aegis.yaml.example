aegis:
  name: "Aegis"
  version: "0.1.0"

llm:
  ollama_base_url: http://localhost:11434
  default_model: qwen2.5-coder:7b
  timeout: 120

# Optional API key authentication
# When set, POST endpoints require X-API-Key header
auth:
  api_key: ""  # empty = auth disabled; use ${AEGIS_API_KEY} for env var

# SQLite execution history
history_db_path: aegis_history.db
history_max_records: 0  # 0 = unlimited; set to e.g. 100 to auto-prune old records

# Event system
event_log_size: 100  # max events in the in-memory ring buffer

# Webhook delivery (fire-and-forget)
# Each webhook receives POST with JSON payload when matching events fire.
# Events matching: exact match only, plus "*" for all events.
# webhooks:
#   - url: https://hooks.slack.com/services/T.../B.../xxx
#     events: ["workflow.completed", "failure.detected"]
#     secret: ""  # optional HMAC-SHA256 signing key; use ${WEBHOOK_SECRET} for env var
#   - url: https://api.github.com/repos/owner/repo/dispatches
#     events: ["*"]
#     secret: ${GITHUB_WEBHOOK_SECRET}
webhooks: []

services:
  qaagent:
    name: "QA Agent"
    description: "Route discovery, risk analysis, test generation & orchestration"
    url: http://localhost:8080
    health_endpoint: /health
    api_key_env: QAAGENT_API_KEY
    features:
      - Route Discovery
      - Risk Assessment
      - Test Generation
      - Test Orchestration
      - Branch Board

  bugalizer:
    name: "Bugalizer"
    description: "AI-powered bug triage, code localization & fix proposals"
    url: http://localhost:8090
    health_endpoint: /health
    api_key_env: BUGALIZER_API_KEY
    features:
      - Bug Triage
      - Code Localization
      - Duplicate Detection

workflows:
  full_pipeline:
    name: "Full QA Pipeline"
    steps:
      - type: discover
        service: qaagent
      - type: test
        service: qaagent
        retries: 2             # retry up to 2 times on failure
        retry_delay: 1.0       # base delay in seconds (exponential backoff)
        timeout: 60.0          # per-step timeout in seconds
      - type: submit_bugs
        service: bugalizer
        condition: has_failures
      - type: verify
        service: qaagent
        condition: has_failures
        timeout: 45.0

  # Example: parallel steps run concurrently via asyncio.gather()
  # parallel_example:
  #   name: "Parallel Discovery"
  #   steps:
  #     - type: discover
  #       service: qaagent
  #       parallel: true
  #     - type: discover
  #       service: another_service
  #       parallel: true
  #     - type: test              # sequential â€” flushes the parallel batch
  #       service: qaagent
